{
  "version": 3,
  "file": "",
  "sourceRoot": "",
  "sources": [
    "../src/main.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\n'use strict'\n\n\n############################################################################################################\ntypes                     = new ( require 'intertype' ).Intertype()\n{ isa\n  type_of\n  validate }              = types.export()\n{ freeze, }               = Object\n\n#-----------------------------------------------------------------------------------------------------------\ndefaults =\n  bare: false\n  raw:  true\n\n#-----------------------------------------------------------------------------------------------------------\ntypes.declare \"jfee_settings\", tests:\n  \"x is an object\":           ( x ) -> @isa.object x\n  \"x.bare is a boolean\":      ( x ) -> @isa.boolean x.bare\n  \"x.raw is a boolean\":       ( x ) -> @isa.boolean x.raw\n\n\n#===========================================================================================================\n#\n#-----------------------------------------------------------------------------------------------------------\nclass @Receiver # extends Object\n  constructor: ( settings ) ->\n    @settings             = freeze { defaults..., settings..., }\n    validate.jfee_settings @settings\n    @collector            = []\n    @[ Symbol.iterator ]  = -> yield from @collector; @collector = []\n    @_resolve             = ->\n    @done                 = false\n    @initializer          = null\n    @is_first             = true\n    @send                 = _send.bind @\n    @advance              = _advance.bind @\n    @ratchet              = new Promise ( resolve ) => @_resolve = resolve\n    return null\n\n  #---------------------------------------------------------------------------------------------------------\n  add_data_channel: ( eventemitter, eventname, $key ) ->\n    switch type = types.type_of $key\n      when 'null', 'undefined'\n        handler = ( $value ) =>\n          @send $value\n          @advance()\n      when 'text'\n        validate.nonempty_text $key\n        handler = ( $value ) =>\n          @send freeze { $key, $value, }\n          @advance()\n      when 'function'\n        handler = ( $value ) =>\n          @send $key $value\n          @advance()\n      when 'generatorfunction'\n        handler = ( $value ) =>\n          @send d for d from $key $value\n          @advance()\n      else\n        throw new Error \"^receiver/add_data_channel@445^ expected a text, a function, or a generatorfunction, got a #{type}\"\n    eventemitter.on eventname, handler\n    return null\n\n  #---------------------------------------------------------------------------------------------------------\n  ### TAINT make `$key` behave as in `add_data_channel()` ###\n  add_initializer: ( $key ) ->\n    ### Send a datom before any other data. ###\n    validate.nonempty_text $key\n    @initializer = freeze { $key, }\n\n  #---------------------------------------------------------------------------------------------------------\n  ### TAINT make `$key` behave as in `add_data_channel()` ###\n  add_terminator: ( eventemitter, eventname, $key = null ) ->\n    ### Terminates async iterator after sending an optional datom to mark termination in stream. ###\n    eventemitter.on eventname, =>\n      @send freeze { $key, } if $key?\n      @advance false\n\n  #---------------------------------------------------------------------------------------------------------\n  @from_child_process: ( cp, settings ) ->\n    validate.childprocess cp\n    rcv = new Receiver settings\n    rcv.add_initializer   '<cp' unless rcv.settings.bare\n    rcv.add_data_channel  cp.stdout, 'data', '^stdout'\n    rcv.add_data_channel  cp.stderr, 'data', '^stderr'\n    rcv.add_terminator    cp, 'close', if rcv.settings.bare then null else '>cp'\n    while not rcv.done\n      await rcv.ratchet; yield from rcv\n    return null\n\n  #---------------------------------------------------------------------------------------------------------\n  @from_readstream: ( stream, settings ) ->\n    # validate.readstream stream\n    rcv = new Receiver settings\n    rcv.add_initializer  '<stream' unless rcv.settings.bare\n    rcv.add_data_channel  stream, 'data',   if rcv.settings.raw  then null else '^line'\n    rcv.add_terminator    stream, 'close',  if rcv.settings.bare then null else '>stream'\n    while not rcv.done\n      await rcv.ratchet; yield from rcv\n    return null\n\n#-----------------------------------------------------------------------------------------------------------\n_send = ( d ) ->\n  if @is_first\n    @is_first = false\n    @collector.push @initializer if @initializer?\n  @collector.push d\n\n#-----------------------------------------------------------------------------------------------------------\n_advance  = ( go_on = true ) ->\n  @done     = not go_on\n  @_resolve()\n  @ratchet  = new Promise ( resolve ) => @_resolve = resolve\n\n"
  ]
}